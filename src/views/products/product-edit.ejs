<!DOCTYPE html>
<html lang="es">

<%- include('../partials/head', { title: 'Editar Servicio/Proyecto | FreeLab' }) %>

<body class="body-pe">
    <%- include('../partials/header') %>

    <div class="container-pe mt-5">
        <div class="card edit-product-card">
            <div class="card-header bg-primary text-white">
                <h1 class="mb-0">Editar Servicio/Proyecto</h1>
            </div>
            <div class="card-body-pe">
                <form action="/productos/editar/<%= product.id %>" method="post" enctype="multipart/form-data" autocomplete="on">
                    <!-- Agregar un input oculto para el ID del producto -->
                    <input type="hidden" name="id" value="<%= product ? product.id : '' %>">
                    <div class="row"></div>
                    <div class="col-12 mb-3">
                        <label for="nombre" class="form-editpe">Habilidad</label>
                        <input name="name" type="text" class="form-control" id="nombre" value="<%= product && product.name || '' %>" required>
                    </div>

                    <div class="mb-3">
                        <label for="descripcion" class="form-editpe">Descripción</label>
                        <textarea name="description" class="form-control" rows="3"
                            placeholder="comentanos sobre vos" id="descripcion"><%= product && product.description || '' %></textarea>
                    </div>

                    <div class="mb-3">
                        <label for="habilidades" class="form-editpe">Habilidades Practicas</label>
                        <input name="skills" type="text" class="form-control" id="habilidades"
                            value="<%= product && product.skills || '' %>" required>
                    </div>
                    <div id="imageFieldsContainer">
                        <div class="mb-3 image-field" data-index="1">
                            <label for="image1" class="form-editimg">Selecciona una imagen:</label>
                            <input type="file" name="image" id="image1" accept="image/*" class="image-inputimg">
                            <!-- Sección para previsualizar las imágenes seleccionadas -->
                            <div class="mt-3 image-preview"></div>
                        </div>
                    
                        <div class="mb-3 image-field" data-index="2" style="display: none;">
                            <label for="image2" class="form-editimg">Selecciona una imagen:</label>
                            <input type="file" name="image" id="image2" accept="image/*" class="image-inputimg">
                            <!-- Sección para previsualizar las imágenes seleccionadas -->
                            <div class="mt-3 image-preview"></div>
                        </div>
                    
                        <div class="mb-3 image-field" data-index="3" style="display: none;">
                            <label for="image3" class="form-editimg">Selecciona una imagen:</label>
                            <input type="file" name="image" id="image3" accept="image/*" class="image-inputimg">
                            <!-- Sección para previsualizar las imágenes seleccionadas -->
                            <div class="mt-3 image-preview"></div>
                        </div>

                        <div class="mb-3 image-field" data-index="4" style="display: none;">
                            <label for="image4" class="form-editimg">Selecciona una imagen:</label>
                            <input type="file" name="image" id="image4" accept="image/*" class="image-inputimg">
                            <!-- Sección para previsualizar las imágenes seleccionadas -->
                            <div class="mt-3 image-preview"></div>
                        </div>
                        
                        <div class="mb-3 image-field" data-index="5" style="display: none;">
                            <label for="image5" class="form-editimg">Selecciona una imagen:</label>
                            <input type="file" name="image" id="image5" accept="image/*" class="image-inputimg">
                            <!-- Sección para previsualizar las imágenes seleccionadas -->
                            <div class="mt-3 image-preview"></div>
                        </div>
                        <!-- Repite lo anterior para los campos de imagen restantes -->
                    </div>
                    
                    
                    <div class="mb-3">
                        <label for="portfolio" class="form-editpe">Link a Portfolio</label>
                        <input name="portfolio" type="url" class="form-control" id="portfolio"
                            value="<%= product && product.portfolio || '' %>">
                    </div>

                    <div class="mb-3">
                        <label for="redes_sociales" class="form-editpe">Links a Redes Sociales</label>
                        <input name="redes_sociales" type="url" class="form-control" id="redes_sociales"
                            value="<%= product && product.redes_sociales || '' %>">
                    </div>

                    <div class="mb-3">
                        <label for="category" class="form-editpe">Categoría</label>
                        <select name="category" class="form-select" id="categoria">
                            <option value="" selected hidden>Selecciona una categoría</option>
                            <option value="redaccion" <%= product && product.category === 'redaccion' ? 'selected' : '' %>>Redacción</option>
                            <option value="desarrollo web" <%= product && product.category === 'desarrollo web' ? 'selected' : '' %>>Desarrollo web</option>
                            <option value="desarrollo de software" <%= product && product.category === 'desarrollo de software' ? 'selected' : '' %>>Desarrollo de software</option>
                            <option value="marketing digital" <%= product && product.category === 'marketing digital' ? 'selected' : '' %>>Marketing digital</option>
                            <option value="programacion web" <%= product && product.category === 'programacion web' ? 'selected' : '' %>>Programación web</option>
                            <option value="ciencia de datos" <%= product && product.category === 'ciencia de datos' ? 'selected' : '' %>>Ciencia de datos</option>
                            <option value="seguridad informatica" <%= product && product.category === 'seguridad informatica' ? 'selected' : '' %>>Seguridad informática</option>
                            <option value="inteligencia artificial" <%= product && product.category === 'inteligencia artificial' ? 'selected' : '' %>>Inteligencia artificial</option>
                            <option value="testing y QA" <%= product && product.category === 'testing y QA' ? 'selected' : '' %>>Testing y QA</option>
                            <option value="desarrollo móvil" <%= product && product.category === 'desarrollo móvil' ? 'selected' : '' %>>Desarrollo móvil</option>
                            <option value="ciberseguridad" <%= product && product.category === 'ciberseguridad' ? 'selected' : '' %>>Ciberseguridad</option>
                            <option value="machine learning" <%= product && product.category === 'machine learning' ? 'selected' : '' %>>Machine learning</option>
                            <option value="devOps" <%= product && product.category === 'devOps' ? 'selected' : '' %>>DevOps</option>
                            <option value="cloud computing" <%= product && product.category === 'cloud computing' ? 'selected' : '' %>>Cloud computing</option>
                            <option value="blockchain" <%= product && product.category === 'blockchain' ? 'selected' : '' %>>Blockchain</option>
                            <option value="realidad virtual" <%= product && product.category === 'realidad virtual' ? 'selected' : '' %>>Realidad virtual</option>
                            <option value="automatización" <%= product && product.category === 'automatización' ? 'selected' : '' %>>Automatización</option>
                            <option value="web scraping" <%= product && product.category === 'web scraping' ? 'selected' : '' %>>Web scraping</option>
                            <!-- Agrega más categorías según sea necesario -->
                        </select>
                        
                    </div>

                    <div class="col-12 mb-3">
                        <div class="input-group">
                            <label for="precio" class="form-editpe me-2" >Precio:</label>
                            <div class="input-group">
                                <span class="input-group-text"> $</span>
                                <input name="price" type="number" class="form-editpe" id="precio"
                                    value="<%= product && product.price || '' %>" required>
                                    <select class="custom-selectpe" id="divisa" name="divisa" required>
                                        <option value="ARS" <%= product && product.divisa === 'ARS' ? 'selected' : '' %>>ARS
                                        </option>
                                        <option value="USD" <%= product && product.divisa === 'USD' ? 'selected' : '' %>>USD
                                        </option>
                                        <option value="EUR" <%= product && product.divisa === 'EUR' ? 'selected' : '' %>>EUR
                                        </option>
                                    </select>
                            </div>
                           
                        </div>
                    </div>


                    <div class="row">
                        <div class="col-6 col-md-5 mx-auto">
                          <button type="button" class="btn btn-primary" onclick="window.history.back();">Cancelar</button>
                        </div>
                        <div class="col-6 col-md-5 mx-auto">
                          <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                        </div>
                      </div>

                </form>
            </div>
        </div>
    </div>
    <%- include('../partials/footer') %>

    <script>
        document.getElementById('image1').addEventListener('change', handleFileSelect);
    
        function handleFileSelect(event) {
            const files = event.target.files;
            const currentIndex = parseInt(event.target.parentNode.getAttribute('data-index'));
            const nextIndex = currentIndex + 1;
    
            for (const file of files) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const imageContainer = document.createElement('div');
                    imageContainer.classList.add('image-preview-item');
                    imageContainer.innerHTML = `
                        <img src="${e.target.result}" alt="${file.name}" class="img-thumbnail">
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeImage(this, ${currentIndex})">Eliminar</button>
                    `;
                    document.querySelector(`.image-field[data-index="${currentIndex}"] .image-preview`).appendChild(imageContainer);
    
                    // Ocultar el campo actual y mostrar el siguiente
                    const nextField = document.querySelector(`.image-field[data-index="${nextIndex}"]`);
                    if (nextField) {
                        nextField.style.display = 'block';
                        document.getElementById(`image${nextIndex}`).addEventListener('change', handleFileSelect);
                    }
                };
                reader.readAsDataURL(file);
            }
        }
    
        function removeImage(button, index) {
            const imageContainer = button.parentNode;
            const imageField = imageContainer.parentNode;
            const currentImageIndex = parseInt(imageField.getAttribute('data-index'));
    
            // Eliminar la imagen visualmente y limpiar el campo de entrada
            imageContainer.parentNode.removeChild(imageContainer);
            document.getElementById(`image${currentImageIndex}`).value = '';
    
            // Ocultar el campo actual y mostrar el siguiente
            imageField.style.display = 'none';
            const nextImageIndex = currentImageIndex + 1;
            const nextField = document.querySelector(`.image-field[data-index="${nextImageIndex}"]`);
            if (nextField) {
                nextField.style.display = 'block';
                document.getElementById(`image${nextImageIndex}`).addEventListener('change', handleFileSelect);
            }
        }
    </script>
    
    
</body>
</html>



